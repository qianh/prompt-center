{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Create Comparison API",
  "description": "Execute a comparison between prompt versions or across LLM providers",
  "method": "POST",
  "path": "/api/comparisons/compare",
  "requestBody": {
    "required": true,
    "content": {
      "application/json": {
        "schema": {
          "type": "object",
          "properties": {
            "name": {
              "type": "string",
              "maxLength": 255,
              "description": "Name for this comparison"
            },
            "description": {
              "type": "string",
              "description": "Optional description of the comparison purpose"
            },
            "type": {
              "type": "string",
              "enum": ["version_comparison", "cross_llm"],
              "description": "Type of comparison to perform"
            },
            "input_text": {
              "type": "string",
              "minLength": 1,
              "maxLength": 10000,
              "description": "Input text to send to the LLM(s)"
            },
            "prompt_version_ids": {
              "type": "array",
              "items": {
                "type": "string",
                "format": "uuid"
              },
              "minItems": 2,
              "maxItems": 10,
              "description": "Array of prompt version IDs to compare"
            },
            "llm_config_id": {
              "type": "string",
              "format": "uuid",
              "description": "LLM config to use for version comparison"
            },
            "llm_config_ids": {
              "type": "array",
              "items": {
                "type": "string",
                "format": "uuid"
              },
              "minItems": 2,
              "maxItems": 5,
              "description": "Array of LLM config IDs for cross-LLM comparison"
            },
            "save_snapshot": {
              "type": "boolean",
              "default": true,
              "description": "Whether to save the comparison as a snapshot"
            }
          },
          "required": ["type", "input_text"],
          "allOf": [
            {
              "if": {
                "properties": {
                  "type": {
                    "const": "version_comparison"
                  }
                }
              },
              "then": {
                "required": ["prompt_version_ids", "llm_config_id"]
              }
            },
            {
              "if": {
                "properties": {
                  "type": {
                    "const": "cross_llm"
                  }
                }
              },
              "then": {
                "required": ["prompt_version_ids", "llm_config_ids"],
                "properties": {
                  "prompt_version_ids": {
                    "maxItems": 1
                  }
                }
              }
            }
          ]
        }
      }
    }
  },
  "responses": {
    "202": {
      "description": "Comparison started successfully",
      "content": {
        "application/json": {
          "schema": {
            "type": "object",
            "properties": {
              "comparison_id": {
                "type": "string",
                "format": "uuid",
                "description": "ID of the created comparison"
              },
              "status": {
                "type": "string",
                "enum": ["pending", "running", "completed", "failed"],
                "description": "Current status of the comparison"
              },
              "estimated_duration": {
                "type": "integer",
                "description": "Estimated time to completion in seconds"
              }
            },
            "required": ["comparison_id", "status"]
          }
        }
      }
    },
    "200": {
      "description": "Comparison completed successfully (synchronous execution)",
      "content": {
        "application/json": {
          "schema": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "format": "uuid"
              },
              "name": {
                "type": "string"
              },
              "type": {
                "type": "string"
              },
              "input_text": {
                "type": "string"
              },
              "results": {
                "type": "object",
                "properties": {
                  "executions": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "prompt_version_id": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "llm_config_id": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "output": {
                          "type": "string"
                        },
                        "execution_time_ms": {
                          "type": "integer"
                        },
                        "tokens_used": {
                          "type": "integer"
                        },
                        "error": {
                          "type": "string"
                        },
                        "status": {
                          "type": "string",
                          "enum": ["success", "error", "timeout"]
                        }
                      },
                      "required": ["prompt_version_id", "status"]
                    }
                  },
                  "summary": {
                    "type": "object",
                    "properties": {
                      "total_executions": {
                        "type": "integer"
                      },
                      "successful_executions": {
                        "type": "integer"
                      },
                      "average_execution_time_ms": {
                        "type": "number"
                      },
                      "total_tokens_used": {
                        "type": "integer"
                      }
                    }
                  }
                }
              },
              "created_at": {
                "type": "string",
                "format": "date-time"
              }
            },
            "required": ["id", "type", "input_text", "results", "created_at"]
          }
        }
      }
    },
    "400": {
      "description": "Bad request - invalid parameters or configuration",
      "content": {
        "application/json": {
          "schema": {
            "type": "object",
            "properties": {
              "error": {
                "type": "string"
              },
              "details": {
                "type": "object"
              }
            },
            "required": ["error"]
          }
        }
      }
    },
    "404": {
      "description": "Prompt version or LLM config not found",
      "content": {
        "application/json": {
          "schema": {
            "type": "object",
            "properties": {
              "error": {
                "type": "string"
              }
            },
            "required": ["error"]
          }
        }
      }
    },
    "500": {
      "description": "Internal server error or LLM provider failure",
      "content": {
        "application/json": {
          "schema": {
            "type": "object",
            "properties": {
              "error": {
                "type": "string"
              }
            },
            "required": ["error"]
          }
        }
      }
    }
  }
}
